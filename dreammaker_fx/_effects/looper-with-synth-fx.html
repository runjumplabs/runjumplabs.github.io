---
layout: default
name: looper-with-synth-fx
effect_type: looper-effects
---
<h5>{{ page.title }} </h3>
<ul>
<li>Created by: {{page.creator}} </li>
<li>Minimum firmware ver: {{page.min_firmware}} </li>
</ul>
<pre><code class="cpp" style="arduino">#include "dm_fx.h"

/*
This is a basic looper pedal that sends the audio going into the loop through
a synth effect.

                +--------+
                |        |
                |        |
Instr In +----->+ Looper +----> Amp Out
                |        |
                |        |
                +-+----+-+
                  |    ^
                  v    |
                +-+----+-+
                | Synth  |
                +--------+

 
 */

fx_looper   loopy( 0.8,   // Dry mix
                   0.8,   // Looped audio mix
                   12,    // Max loop length in seconds
                   true); // Disable FX processing as audio enters the loop

fx_shaper    synth_sound(0.7,    // Clean mix
                         0.7,    // Shaper mix
                         0.2,    // Octave 1 mix
                         0.2);   // Octave 2 mix
                         

void setup() {
  
  // put your setup code here, to run once:
  pedal.init();

  // Pass audio through looper only
  pedal.route_audio(pedal.instr_in, loopy.input);
  pedal.route_audio(loopy.output, pedal.amp_out);

  // Patch FX of looper into the octave out of the synth
  pedal.route_audio(loopy.preproc_send, synth_sound.input);
  pedal.route_audio(synth_sound.oct_1_output, loopy.preproc_receive);


  // Optional code to print out the routing details to console
  if (true) {
    pedal.print_instance_stack();
    pedal.print_routing_table();
    pedal.print_param_tables();
  }
  
  // Run this effect
  pedal.run();

}
  
void loop() {

  // Add an event if pot 0 has changed
  if (pedal.pot_0.has_changed()) { 
  } 

  // Add an event if pot 0 has changed
  if (pedal.pot_1.has_changed()) { 
  } 

  #if 0
    // Add an event if pot 2 has changed (DOESN'T WORK ON FIRST GEN HARDWARE YET)
    if (pedal.pot_2.has_changed()) { 
    } 
  #endif   

  // Service 
  pedal.service();
}

// Footswitch 1 - typically used for enable/bypass
void footswitch_1_pressed() { 
  
  // Declared as static so state is preserved between calls
  static bool bypassed = false;

  // Bypass code
  if (bypassed) {
    // If we are currently bypassed, switch pedal to active mode and turn on LED next to SW1
    pedal.enable_fx();
    digitalWrite(PIN_FOOTSW_LED_1, HIGH); // Turn on LED
  } else {
    // If we are currently active, switch pedal to bypassed mode and turn off LED next to SW1
    pedal.bypass_fx();
    digitalWrite(PIN_FOOTSW_LED_1, LOW);  // Turn off LED
  }
  bypassed = !bypassed; // Toggle bypassed state variable
}

// Footswitch 2 - used to trigger loop
void footswitch_2_pressed() {

  static bool looping = false;

  if (!looping) {
    loopy.start_loop_recording();
    Serial.println("\nLoop recording");
    digitalWrite(PIN_FOOTSW_LED_2, HIGH); // Turn on LED
  } else {
    loopy.stop_loop_recording();
    Serial.println("\nLoop recording complete");
    digitalWrite(PIN_FOOTSW_LED_2, LOW); // Turn off LED
  }

  looping = !looping;
}

</code></pre>
