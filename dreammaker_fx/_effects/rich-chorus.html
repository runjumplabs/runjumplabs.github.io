---
layout: default
name: rich-chorus
effect_type: variable-delay-based-effects
---
<h5>{{ page.title }} </h3>
<ul>
<li>Created by: {{page.creator}} </li>
<li>Minimum firmware ver: {{page.min_firmware}} </li>
<li>Description: {{page.description}} </li>
</ul>
<strong>Arduino sketch</strong>
<pre><code class="cpp" style="arduino">#include "dm_fx.h"

/*


*/

fx_variable_delay var_del1(0.31, 0.2, -0.1, OSC_SINE);
fx_variable_delay var_del2(0.33, 0.1, -0.1, OSC_SINE);
fx_variable_delay var_del3(0.37, 0.15, -0.1, OSC_SINE);

fx_variable_delay pitch_mod(2.0, 0.3, 0.0, OSC_SINE);

fx_mixer_3    mix3;

fx_gain       post_gain(0.3);

void setup() {
  
  // put your setup code here, to run once:
  pedal.init();

  // Route audio
  pedal.route_audio(pedal.instr_in, var_del1.input);
  pedal.route_audio(pedal.instr_in, var_del2.input);
  pedal.route_audio(pedal.instr_in, var_del3.input);

  pedal.route_audio(var_del1.output, mix3.input_1);
  pedal.route_audio(var_del2.output, mix3.input_2);
  pedal.route_audio(var_del3.output, mix3.input_3);
  
  pedal.route_audio(mix3.output, post_gain.input);
  pedal.route_audio(post_gain.output, pitch_mod.input);
  pedal.route_audio(pitch_mod.modulated_out, pedal.amp_out);

  // Run this effect
  pedal.run();

}
  
void loop() {

  // Service 
  pedal.service();
}


// Footswitch 1 - typically used for enable/bypass
void footswitch_1_pressed() { 
  
  Serial.println("\nSW1 pressed");

  // Declared as static so state is preserved between calls
  static bool bypassed = false;

  // Bypass code
  if (bypassed) {
    // If we are currently bypassed, switch pedal to active mode and turn on LED next to SW1
    pedal.enable_fx();
    digitalWrite(PIN_FOOTSW_LED_1, HIGH); // Turn on LED
  } else {
    // If we are currently active, switch pedal to bypassed mode and turn off LED next to SW1
    pedal.bypass_fx();
    digitalWrite(PIN_FOOTSW_LED_1, LOW);  // Turn off LED
  }
  bypassed = !bypassed; // Toggle bypassed state variable
}

// Footswitch 2 - add code here to handle what SW2 does
void footswitch_2_pressed() { 
  Serial.println("\nSW2 pressed");
}

// User PB on PCB - add code here to handle what the User PB on the PCB does
void user_pb_pressed() { 
  Serial.println("\nUser PB pressed");
}

</code></pre>
